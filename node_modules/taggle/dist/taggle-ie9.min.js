/*!
* @author Sean Coker <sean@seancoker.com>
* @version 1.4.0
* @url http://sean.is/poppin/tags
* @license MIT
* @description Taggle is a dependency-less tagging library
*/
(function(){"undefined"==typeof document||"classList"in document.documentElement||function(e){"use strict";if("HTMLElement"in e||"Element"in e){var t="classList",n="prototype",a=(e.HTMLElement||e.Element)[n],l=Object,i=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array[n].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},r=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},o=function(e,t){if(""===t)throw new r("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new r("INVALID_CHARACTER_ERR","String contains an invalid character");return s.call(e,t)},c=function(e){for(var t=i.call(e.className),n=t?t.split(/\s+/):[],a=0,l=n.length;l>a;a++)this.push(n[a]);this._updateClassName=function(){e.className=""+this}},u=c[n]=[],d=function(){return new c(this)};if(r[n]=Error[n],u.item=function(e){return this[e]||null},u.contains=function(e){return e+="",-1!==o(this,e)},u.add=function(){var e,t=arguments,n=0,a=t.length,l=!1;do e=t[n]+"",-1===o(this,e)&&(this.push(e),l=!0);while(a>++n);l&&this._updateClassName()},u.remove=function(){var e,t=arguments,n=0,a=t.length,l=!1;do{e=t[n]+"";var i=o(this,e);-1!==i&&(this.splice(i,1),l=!0)}while(a>++n);l&&this._updateClassName()},u.toggle=function(e,t){e+="";var n=this.contains(e),a=n?t!==!0&&"remove":t!==!1&&"add";return a&&this[a](e),!n},u.toString=function(){return this.join(" ")},l.defineProperty){var g={get:d,enumerable:!0,configurable:!0};try{l.defineProperty(a,t,g)}catch(f){-2146823252===f.number&&(g.enumerable=!1,l.defineProperty(a,t,g))}}else l[n].__defineGetter__&&a.__defineGetter__(t,d)}}(self)})(),function(e,t){function n(){if(!(2>arguments.length)){for(var e=arguments[0],t=1,n=arguments.length;n>t;t++){var a=arguments[t];for(var l in a)a.hasOwnProperty(l)&&(e[l]=a[l])}return e}}function a(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}function l(e,t){var n="a"===e.tagName.toLowerCase()?e.parentNode:e,a=t.elements.indexOf(n);t.elements.splice(a,1),t.values.splice(a,1)}function i(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}function s(e){return e.replace(/^\s+|\s+$/g,"")}function r(t,n){e.attachEvent&&!e.addEventListener?t.innerText=n:t.textContent=n}var o={additionalTagClasses:"",allowDuplicates:!1,duplicateTagClass:"",containerFocusClass:"active",hiddenInputName:"taggles[]",tags:[],allowedTags:[],tabIndex:1,placeholder:"Enter tags...",onTagAdd:function(){},onTagRemove:function(){}},c=8,u=188,d=9,g=13,f=function(f,p){function v(){h(),m(),y()}function h(){var t,n,a;D.container.rect=z.getBoundingClientRect(),D.container.style=e.getComputedStyle(z),t=D.container.style,n=parseInt(t["padding-left"]||t.paddingLeft,10),a=parseInt(t["padding-right"]||t.paddingRight,10),D.container.padding=n+a}function m(){var t;if(V.className="taggle_list",M.type="text",M.className="taggle_input",M.tabIndex=F.tabIndex,P.className="taggle_sizer",F.tags.length)for(var n=0,a=F.tags.length;a>n;n++){var l=R(F.tags[n]);V.appendChild(l)}q&&(q.style.opacity=0,q.classList.add("taggle_placeholder"),z.appendChild(q),r(q,F.placeholder),F.tags.length||(q.style.opacity=1)),H.appendChild(M),V.appendChild(H),z.appendChild(V),z.appendChild(P),t=e.getComputedStyle(M).fontSize,P.style.fontSize=t}function y(){i(z,"click",function(){M.focus()}),M.onfocus=x,M.onblur=S,i(M,"keydown",A),i(M,"keyup",b)}function C(){var e,t,n,a,l;E(),t=M.getBoundingClientRect(),n=D.container.rect,e=~~n.width,e||(e=~~n.right-~~n.left),a=~~t.left-~~n.left,l=D.container.padding,E(e-a-l)}function L(e){return e?!F.allowDuplicates&&_(e)?!1:F.allowedTags.length&&-1===F.allowedTags.indexOf(e)?!1:!0:!1}function T(e,t){var n,a,l,i="string"==typeof t?t.toLowerCase():s(M.value.toLowerCase());L(i)&&(n=R(i),a=V.querySelectorAll("li"),l=a[a.length-1],V.insertBefore(n,l),F.onTagAdd(e,i),M.value="",E(),C(),x())}function w(t){t=t||e.event;var n=z.querySelectorAll(".taggle"),a=n[n.length-1],l="taggle_hot",i=M.classList.contains("taggle_back");""!==M.value||t.keyCode!==c||i?a.classList.contains(l)&&a.classList.remove(l):a.classList.contains(l)?(M.classList.add("taggle_back"),O(a,t),C(),x()):a.classList.add(l)}function E(e){M.style.width=(e||10)+"px"}function _(e){var t,n=j.values.indexOf(e),a=z.querySelector(".taggle_list");if(F.duplicateTagClass){t=a.querySelectorAll("."+F.duplicateTagClass);for(var l=0,i=t.length;i>l;l++)t[l].classList.remove(F.duplicateTagClass)}return n>-1?(F.duplicateTagClass&&a.childNodes[n].classList.add(F.duplicateTagClass),!0):!1}function N(e){var t=!1;return(e===u||e===d||e===g)&&(t=!0),t}function x(){C(),z.classList.contains(F.containerFocusClass)||z.classList.add(F.containerFocusClass),q&&(q.style.opacity=0)}function S(){M.value="",E(),z.classList.contains(F.containerFocusClass)&&z.classList.remove(F.containerFocusClass),!j.values.length&&q&&(q.style.opacity=1)}function A(t){t=t||e.event;var n=t.keyCode;return k(),N(n)&&""!==M.value?(I(t),undefined):(j.values.length&&w(t),undefined)}function b(t){t=t||e.event,M.classList.remove("taggle_back"),r(P,M.value)}function I(t){t=t||e.event,T(t),t.preventDefault?t.preventDefault():t.returnValue=!1}function k(){var e=P.getBoundingClientRect().width,t=D.container.rect.width-D.container.padding,n=parseInt(P.style.fontSize,10);e+1.5*n>parseInt(M.style.width,10)&&(M.style.width=t+"px")}function R(e){var n=t.createElement("li"),a=t.createElement("a"),l=t.createElement("input"),i=t.createElement("span");return e=e.toLowerCase(),a.href="javascript:void(0)",a.innerHTML="&times;",a.className="close",a.onclick=O.bind(null,a),r(i,e),i.className="taggle_text",n.className="taggle "+F.additionalTagClasses,l.type="hidden",l.value=e,l.name=F.hiddenInputName,n.appendChild(i),n.appendChild(a),n.appendChild(l),j.values.push(e),j.elements.push(n),n}function O(e,t){var n,a;"li"!==e.tagName.toLowerCase()&&(e=e.parentNode),n=e.querySelector(".taggle_text"),a=n.innerText||n.textContent,F.onTagRemove(t,a),e.parentNode.removeChild(e),l(e,j),x()}var q,B=this,F=n({},o,p),D={container:{rect:null,style:null,padding:null}},z=f,j={values:[],elements:[]},V=t.createElement("ul"),H=t.createElement("li"),M=t.createElement("input"),P=t.createElement("div");F.placeholder&&(q=t.createElement("span")),"string"==typeof f&&(z=t.getElementById(f)),B.getTags=function(){return j},B.getTagElements=function(){return j.elements},B.getTagValues=function(){return j.values},B.getInput=function(){return M},B.getContainer=function(){return z},B.add=function(e){var t=a(e);if("string"==typeof e)return T(null,e);if(t)for(var n=0,l=e.length;l>n;n++)"string"==typeof e[n]&&T(null,e[n]);return B},B.remove=function(e,t){for(var n=j.values.length-1,a=!1;n>-1&&(j.values[n]===e&&(a=!0,O(j.elements[n])),!a||t);)n--;return B},v()};e.Taggle=f}(window,document);